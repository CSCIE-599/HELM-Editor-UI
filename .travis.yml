language: node_js

node_js:
  - "4.3.2"

cache:
  directories:
    - node_modules
    - bower_components

env:
  global:
    - secure: "bpCnkolAyhiEe/X+lbuwgAerO44Depp33eQWE/YDjlQGwOoGR50Ee0WY4Mw3qDQZHX/T21OTU3XOkKOwxR61o8gZcNS/5SfV/b8gjcvyaXIFdQXbqs1BNiysVxoRpIWO8Fdj5bCOUOLUHWNg46whF7va+2+5767FWNoRYLSu9iuIgbqxNiHEiuWZe/7eBsbOrKouLmWXBB224j7Y8V8Eigf6ImsziMy8U/+bjJ7v7fBqjbg3+YR0aSBbfRyNvEcAua0QqG0MicSXXP6E9BLaoEb1/MeanxFHX3SzgODY0DDRXX4XcwCbARZsNY7U9R2Jhq5zMQZq7k5kcCyfll6a2mXSjDR0xY7AM5pA7XG4qTIwK/jWJU9mGrSdyUizYwcWiML1444gs+7OFRYwEMPF2hJb6jAqL0g1N1aKFavGHKU1RFflIGn5x8VHTo+a/GYf91bWTeJaaIYpocWZoA4Tzqv9X750DSrt6QJSHSTZwzDgoVltTvF5GvZvAiGkL/EESVzWq0WWsfSBbMTj8ygxK9pLf0eR7mI2M78M2pF9nX0FMqnYigI06BtIRwJuvQCFpl8EzVPLyNigq1T+Vttc32G4FlqSlN6aGEOFv71CZwQiRlTinIl0OXZ3kIvTy9Dw/EkAO5ixeQqnhl7W5SLR8zpeOFNyBnoDcAr8RbYcJUs="
    - secure: "IqZpmfZ+F2FoMrGrT122h6fZwOTV1FR/D7FxQZONb36A0++4Uy7Oucao5gFd05ZZVUYKwW8pyWchEhmtH3zXEs66KeRJgg4Fy8D3y46MCrATIgxgF4ujFC4Esz0m6ktcIgMtPcapxdyiAkx3GoGZzP9O4qeQzh0XEGl4KT4gCu7rjR2ozv8dWvS2plZnIr0SW7UOe1u8Zkdh3s0oL+U2/awC4HRhCoVvMlbOSLya8w3J9GtmNV8iXJoBSc0mHwgv8933237HbdTmQV+U6aeabQL/n2Y4hUacUenVsF2g5LFBB9SSjRiHrWaungGj2xVKPMmF39qqTwCQkE1w4FZGe1vbOwpZuM8tczb5ZNdKciZ3Maas3Vc/XbLsDK2qUDXEEKSjNW+9pb4Xm2ShpQ6C5UXegqfXt+NxrvSIyFEDqMc1oLzTldW8gnhvQdYD3wSTsfKmoGJ4pOARaADyZMZM3ViFqPtqv0Z1kXuMl7Pg9v9Bfm7D20W8OTB9moScckRAGCo9U46M5Jhwr8P5uwlI9bnscKQb+lw0pbbuIx+u+DK0ubBedWWFaHtzqkooeZuB5Fg+hPIzp2gajYuOlpcN9l/sG2Cg5KWiCZvwkcToMkP9t4y6Qayni98VHZongFu9qz2eZ5XmDr6DzIaFgRv2szPiLyMpf9rxWq3jDhkS0DE="

addons:
  apt:
    packages:
      - sshpass

before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - sleep 3 # give xvfb some time to start
  - npm install -g grunt-cli
  - npm install -g bower
  - npm install
  - bower install
  - nohup bash -c "./nodemodules/protractor/bin/webdriver-manager start --standalone 2>&1 &"
  - sleep 5

script:
  - echo "running tests"
  - grunt test
  - grunt protractor-firefox

after_success:
  - echo "deploying"
  - grunt build
  - ls
  - tar -czf dist.tgz dist
  - export SSHPASS=$DEPLOY_PASS
  - sshpass -e scp dist.tgz $DEPLOY_DEST
