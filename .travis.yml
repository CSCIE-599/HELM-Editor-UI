language: node_js

node_js:
  - "4.3.2"

cache:
  directories:
    - node_modules
    - bower_components

env:
  global:
    - secure: "bpCnkolAyhiEe/X+lbuwgAerO44Depp33eQWE/YDjlQGwOoGR50Ee0WY4Mw3qDQZHX/T21OTU3XOkKOwxR61o8gZcNS/5SfV/b8gjcvyaXIFdQXbqs1BNiysVxoRpIWO8Fdj5bCOUOLUHWNg46whF7va+2+5767FWNoRYLSu9iuIgbqxNiHEiuWZe/7eBsbOrKouLmWXBB224j7Y8V8Eigf6ImsziMy8U/+bjJ7v7fBqjbg3+YR0aSBbfRyNvEcAua0QqG0MicSXXP6E9BLaoEb1/MeanxFHX3SzgODY0DDRXX4XcwCbARZsNY7U9R2Jhq5zMQZq7k5kcCyfll6a2mXSjDR0xY7AM5pA7XG4qTIwK/jWJU9mGrSdyUizYwcWiML1444gs+7OFRYwEMPF2hJb6jAqL0g1N1aKFavGHKU1RFflIGn5x8VHTo+a/GYf91bWTeJaaIYpocWZoA4Tzqv9X750DSrt6QJSHSTZwzDgoVltTvF5GvZvAiGkL/EESVzWq0WWsfSBbMTj8ygxK9pLf0eR7mI2M78M2pF9nX0FMqnYigI06BtIRwJuvQCFpl8EzVPLyNigq1T+Vttc32G4FlqSlN6aGEOFv71CZwQiRlTinIl0OXZ3kIvTy9Dw/EkAO5ixeQqnhl7W5SLR8zpeOFNyBnoDcAr8RbYcJUs="
    - secure: "grvBawoZwHkKxJVM/U5m6/4i0iN6kn78Gx6+5CDvVeMz1z4MCpLL62FaTY0WObhjPJtOYBbSw3V6I+zQ0WhkKcE11dQe+bKjVsoyneZ5fzmAPyW+u2vjkJect7pDO1jiEqsuiMUxMgSdLnm05nPQhTAgcP/eKaUJlkNHSAjCidJnmYVbYmPmCcj0nMdwdrFZ2p39uUQVQk+dNuRLcbk3G6lLc6fzkyzePmRAfTy6NKItZc/qsnAx8AYAr4yn8bjDZ4VStkFV7Y9bAwitdwcN1USnWGHOdtAizcH3h09Zmi9dt8g654mkfVuQsjUIe+z0dYC/t2hBl1hmELcdgId6uwIpyTqtpTk6HV/gZ+K3iflB/RlWdBmG+p1vp3hzpcvcZ4+WziCR7JVlm4VjRePAJeUk9A7GvKt8aXVlatv+/4t73xLtA90uSY5KtQ/LtrU9GWzbgofrkAfj7Khx1jWbmEy7vd0f6w5+jMZ6wKjdtRpkmF/HQgc5KZuUmdiHlb8YGrHsStJAlDSZH9j72gVZfiHSxM0J8c0OUfGqwJxMCon+mSpI35RM72rDwUj0ex2p1zOJ21h5tkXtVe+wlmq//R00hbW50DGSCe+S6hAYkhVCssKg+6spUTjx2CeY4Ovb3+xbJwKwcnxjR5kxkUfTUhURTOkYn98/hTB+cl/c0bw="

addons:
  apt:
    packages:
      - sshpass

before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - sleep 3 # give xvfb some time to start
  - npm install -g grunt-cli
  - npm install -g bower
  - npm install
  - bower install
  - nohup bash -c "./nodemodules/protractor/bin/webdriver-manager start --standalone 2>&1 &"
  - sleep 5

script:
  - echo "running tests"
  - grunt test
  - grunt protractor-firefox

after_success:
  - echo "deploying"
  - grunt build
  - tar -czf dist.tgz dist
  - export SSHPASS=$DEPLOY_PASS
  - sshpass -e scp -o stricthostchecking=no dist.tgz $DEPLOY_DEST
